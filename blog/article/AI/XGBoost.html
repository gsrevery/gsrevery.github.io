<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>XGBoost | gp&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="学而时习之不亦说乎，有朋至远方来不亦乐乎。">
    
    <link rel="preload" href="/blog/assets/css/0.styles.e32d6808.css" as="style"><link rel="preload" href="/blog/assets/js/app.8527b2d6.js" as="script"><link rel="preload" href="/blog/assets/js/2.68d50f3f.js" as="script"><link rel="preload" href="/blog/assets/js/1.0e421e36.js" as="script"><link rel="preload" href="/blog/assets/js/45.c63b273c.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d6c6ae10.js"><link rel="prefetch" href="/blog/assets/js/11.df0ee021.js"><link rel="prefetch" href="/blog/assets/js/12.3f432822.js"><link rel="prefetch" href="/blog/assets/js/13.659f6263.js"><link rel="prefetch" href="/blog/assets/js/14.0512b144.js"><link rel="prefetch" href="/blog/assets/js/15.0c854103.js"><link rel="prefetch" href="/blog/assets/js/16.e1b887ae.js"><link rel="prefetch" href="/blog/assets/js/17.3c6d46a7.js"><link rel="prefetch" href="/blog/assets/js/18.bef6e86e.js"><link rel="prefetch" href="/blog/assets/js/19.e4b19d88.js"><link rel="prefetch" href="/blog/assets/js/20.ff3cf5e0.js"><link rel="prefetch" href="/blog/assets/js/21.8df737f4.js"><link rel="prefetch" href="/blog/assets/js/22.88ae7534.js"><link rel="prefetch" href="/blog/assets/js/23.d74d45a0.js"><link rel="prefetch" href="/blog/assets/js/24.bdd39c58.js"><link rel="prefetch" href="/blog/assets/js/25.b9ea98ae.js"><link rel="prefetch" href="/blog/assets/js/26.afff07f5.js"><link rel="prefetch" href="/blog/assets/js/27.be74bbc5.js"><link rel="prefetch" href="/blog/assets/js/28.46333eef.js"><link rel="prefetch" href="/blog/assets/js/29.4e25f2f8.js"><link rel="prefetch" href="/blog/assets/js/3.1fe88f52.js"><link rel="prefetch" href="/blog/assets/js/30.58ff25d0.js"><link rel="prefetch" href="/blog/assets/js/31.9a6b5a74.js"><link rel="prefetch" href="/blog/assets/js/32.8550b6e6.js"><link rel="prefetch" href="/blog/assets/js/33.006146e5.js"><link rel="prefetch" href="/blog/assets/js/34.a4f5a914.js"><link rel="prefetch" href="/blog/assets/js/35.b9f77b46.js"><link rel="prefetch" href="/blog/assets/js/36.658b3d04.js"><link rel="prefetch" href="/blog/assets/js/37.95e93b80.js"><link rel="prefetch" href="/blog/assets/js/38.f036a910.js"><link rel="prefetch" href="/blog/assets/js/39.27185529.js"><link rel="prefetch" href="/blog/assets/js/4.e3e7604a.js"><link rel="prefetch" href="/blog/assets/js/40.c163013e.js"><link rel="prefetch" href="/blog/assets/js/41.a66516a2.js"><link rel="prefetch" href="/blog/assets/js/42.9fbe37d5.js"><link rel="prefetch" href="/blog/assets/js/43.11103ddb.js"><link rel="prefetch" href="/blog/assets/js/44.6504c911.js"><link rel="prefetch" href="/blog/assets/js/46.0c12f167.js"><link rel="prefetch" href="/blog/assets/js/47.96234066.js"><link rel="prefetch" href="/blog/assets/js/48.f5274c4d.js"><link rel="prefetch" href="/blog/assets/js/49.0a394c47.js"><link rel="prefetch" href="/blog/assets/js/5.eab0b336.js"><link rel="prefetch" href="/blog/assets/js/50.636c2074.js"><link rel="prefetch" href="/blog/assets/js/51.179bc426.js"><link rel="prefetch" href="/blog/assets/js/52.f9b420ce.js"><link rel="prefetch" href="/blog/assets/js/53.df957a6a.js"><link rel="prefetch" href="/blog/assets/js/54.5e900aab.js"><link rel="prefetch" href="/blog/assets/js/55.8acc1742.js"><link rel="prefetch" href="/blog/assets/js/56.fc98b71f.js"><link rel="prefetch" href="/blog/assets/js/57.b04385c6.js"><link rel="prefetch" href="/blog/assets/js/58.745a4ab5.js"><link rel="prefetch" href="/blog/assets/js/59.5a35f71f.js"><link rel="prefetch" href="/blog/assets/js/6.8ecdb1da.js"><link rel="prefetch" href="/blog/assets/js/60.08dae80d.js"><link rel="prefetch" href="/blog/assets/js/61.619fcdf2.js"><link rel="prefetch" href="/blog/assets/js/62.10725877.js"><link rel="prefetch" href="/blog/assets/js/63.03736efb.js"><link rel="prefetch" href="/blog/assets/js/64.3f1b4234.js"><link rel="prefetch" href="/blog/assets/js/65.f561609e.js"><link rel="prefetch" href="/blog/assets/js/66.19d3b47c.js"><link rel="prefetch" href="/blog/assets/js/67.4e36c39a.js"><link rel="prefetch" href="/blog/assets/js/68.94c954bd.js"><link rel="prefetch" href="/blog/assets/js/69.3f5671f3.js"><link rel="prefetch" href="/blog/assets/js/7.4f1bdf28.js"><link rel="prefetch" href="/blog/assets/js/70.afc7786a.js"><link rel="prefetch" href="/blog/assets/js/71.630ca26b.js"><link rel="prefetch" href="/blog/assets/js/72.71b5b151.js"><link rel="prefetch" href="/blog/assets/js/73.a7ea6c24.js"><link rel="prefetch" href="/blog/assets/js/74.54bdfa14.js"><link rel="prefetch" href="/blog/assets/js/75.61b2e578.js"><link rel="prefetch" href="/blog/assets/js/76.0838591b.js"><link rel="prefetch" href="/blog/assets/js/77.46de6115.js"><link rel="prefetch" href="/blog/assets/js/78.3bc92274.js"><link rel="prefetch" href="/blog/assets/js/79.ce69ce9f.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.9177c0e9.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.e32d6808.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">gp's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/article/JavaScript/Rule.html" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/blog/AboutMe.html" class="nav-link">
  Resume
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/article/JavaScript/Rule.html" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/blog/AboutMe.html" class="nav-link">
  Resume
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/JavaScript/Optimization.html" class="sidebar-link">优化</a></li><li><a href="/blog/article/JavaScript/Rule.html" class="sidebar-link">代码规范</a></li><li><a href="/blog/article/JavaScript/QA-daily.html" class="sidebar-link">练习题目</a></li><li><a href="/blog/article/JavaScript/Object.html" class="sidebar-link">对象</a></li><li><a href="/blog/article/JavaScript/Array.html" class="sidebar-link">数组</a></li><li><a href="/blog/article/JavaScript/Function.html" class="sidebar-link">函数</a></li><li><a href="/blog/article/JavaScript/Ram.html" class="sidebar-link">内存</a></li><li><a href="/blog/article/JavaScript/Method.html" class="sidebar-link">常用方法</a></li><li><a href="/blog/article/JavaScript/PublicFunction.html" class="sidebar-link">公共方法</a></li><li><a href="/blog/article/JavaScript/Robustness.html" class="sidebar-link">代码健壮性</a></li><li><a href="/blog/article/JavaScript/Tree.html" class="sidebar-link">树</a></li><li><a href="/blog/article/JavaScript/This.html" class="sidebar-link">this指向</a></li><li><a href="/blog/article/JavaScript/EventLoop.html" class="sidebar-link">事件循环机制</a></li><li><a href="/blog/article/JavaScript/CrossDomain.html" class="sidebar-link">跨域</a></li><li><a href="/blog/article/JavaScript/Bubble.html" class="sidebar-link">冒泡</a></li><li><a href="/blog/article/JavaScript/CommonlyMethod.html" class="sidebar-link">数据特殊处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Css/Css.html" class="sidebar-link">css</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Vue/Components.html" class="sidebar-link">组件</a></li><li><a href="/blog/article/Vue/CrossDomain.html" class="sidebar-link">跨域</a></li><li><a href="/blog/article/Vue/Reconstruction.html" class="sidebar-link">项目重构优化</a></li><li><a href="/blog/article/Vue/Question.html" class="sidebar-link">vue问题</a></li><li><a href="/blog/article/Vue/FileHandle.html" class="sidebar-link">文件处理</a></li><li><a href="/blog/article/Vue/Router.html" class="sidebar-link">路由</a></li><li><a href="/blog/article/Vue/Table.html" class="sidebar-link">表格</a></li><li><a href="/blog/article/Vue/SpecialPage.html" class="sidebar-link">页面</a></li><li><a href="/blog/article/Vue/Seo.html" class="sidebar-link">SEO优化</a></li><li><a href="/blog/article/Vue/Package.html" class="sidebar-link">package配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>App</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/APP/UniApp.html" class="sidebar-link">uni-app</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Other/Git.html" class="sidebar-link">git操作</a></li><li><a href="/blog/article/Other/Canvas.html" class="sidebar-link">canvas</a></li><li><a href="/blog/article/Other/Qiankun.html" class="sidebar-link">qiankun</a></li><li><a href="/blog/article/Other/LODOP.html" class="sidebar-link">lodop插件</a></li><li><a href="/blog/article/Other/Npm.html" class="sidebar-link">npm私有库</a></li><li><a href="/blog/article/Other/Interview.html" class="sidebar-link">问题总结</a></li><li><a href="/blog/article/Other/ProjectLssues.html" class="sidebar-link">运行项目问题</a></li><li><a href="/blog/article/Other/OnlinePayment.html" class="sidebar-link">在线支付</a></li><li><a href="/blog/article/Other/PluginUnit.html" class="sidebar-link">js常用的各种插件</a></li><li><a href="/blog/article/Other/Vscode.html" class="sidebar-link">vscode常用插件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Three</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Three/Overview.html" class="sidebar-link">Three概览</a></li><li><a href="/blog/article/Three/Optimize.html" class="sidebar-link">Three性能优化</a></li><li><a href="/blog/article/Three/IntelligentPackingFunction.html" class="sidebar-link">Three常见问题及解决方案</a></li><li><a href="/blog/article/Three/Cannon.html" class="sidebar-link">Cannon物理引擎</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Python/Basic.html" class="sidebar-link">Basic基础</a></li><li><a href="/blog/article/Python/FixexMethod.html" class="sidebar-link">FixexMethod固定方法</a></li><li><a href="/blog/article/Python/Grammar.html" class="sidebar-link">Grammar语法</a></li><li><a href="/blog/article/Python/PySide6.html" class="sidebar-link">PySide6</a></li><li><a href="/blog/article/Python/Use.html" class="sidebar-link">Use使用</a></li><li><a href="/blog/article/Python/Crawler.html" class="sidebar-link">Crawler爬虫</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>AI</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/AI/XGBoost.html" aria-current="page" class="active sidebar-link">XGBoost</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#xgboost-介绍" class="sidebar-link">XGBoost 介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#一、核心思想与加法训练框架" class="sidebar-link">一、核心思想与加法训练框架</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#二、目标函数与二阶泰勒展开-核心创新" class="sidebar-link">二、目标函数与二阶泰勒展开（核心创新）</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#三、树的构建与分裂策略" class="sidebar-link">三、树的构建与分裂策略</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#四、关键特性与工程优化" class="sidebar-link">四、关键特性与工程优化</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#五、预测与模型输出" class="sidebar-link">五、预测与模型输出</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#核心原理对比-xgboost-vs-传统gbdt" class="sidebar-link">核心原理对比（XGBoost vs 传统GBDT）</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#xgboost-的安装" class="sidebar-link">XGBoost 的安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#xgboost-2" class="sidebar-link">xgboost</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#jupyter" class="sidebar-link">jupyter</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#pandas" class="sidebar-link">pandas</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#numpy" class="sidebar-link">numpy</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#scikit-learn" class="sidebar-link">scikit-learn</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#matplotlib" class="sidebar-link">matplotlib</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#seaborn" class="sidebar-link">seaborn</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#学习场景" class="sidebar-link">学习场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#场景1-泰坦尼克号生存预测" class="sidebar-link">场景1：泰坦尼克号生存预测</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#导出模型" class="sidebar-link">导出模型</a></li><li class="sidebar-sub-header"><a href="/blog/article/AI/XGBoost.html#使用导出的模型" class="sidebar-link">使用导出的模型</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="xgboost"><a href="#xgboost" class="header-anchor">#</a> XGBoost</h1> <h2 id="xgboost-介绍"><a href="#xgboost-介绍" class="header-anchor">#</a> XGBoost 介绍</h2> <p>XGBoost（eXtreme Gradient Boosting）是梯度提升决策树（GBDT）的高效优化实现，核心是通过前向分步加法训练、二阶泰勒展开近似损失与正则化控制，结合工程优化实现高精度与高效率，常用于分类、回归、排序等任务。以下从核心原理、关键创新、工程优化三方面展开说明：</p> <hr> <h3 id="一、核心思想与加法训练框架"><a href="#一、核心思想与加法训练框架" class="header-anchor">#</a> 一、核心思想与加法训练框架</h3> <p>XGBoost遵循梯度提升的核心逻辑：串行训练多棵决策树，每棵树拟合前一轮模型的预测残差（负梯度），最终将所有树的预测结果加权累加得到最终预测，公式如下：</p> <p>$\hat{y}_i^{(t)} = \hat{y}_i^{(t-1)} + f_t(x_i)$</p> <p>其中， $\hat{y}_i^{(t)}$  是第  $t$  轮对样本  $i$  的预测值， $f_t$  是第  $t$  棵决策树， $\hat{y}_i^{(t-1)}$  是前  $t-1$  棵树的累加预测结果。训练目标是最小化目标函数，逐步降低模型误差。</p> <hr> <h3 id="二、目标函数与二阶泰勒展开-核心创新"><a href="#二、目标函数与二阶泰勒展开-核心创新" class="header-anchor">#</a> 二、目标函数与二阶泰勒展开（核心创新）</h3> <p>XGBoost的目标函数由<strong>训练损失项</strong>和<strong>正则化项</strong>组成，能在拟合数据的同时控制模型复杂度，公式如下：</p> <p>$Obj^{(t)} = \sum_{i=1}^n L(y_i, \hat{y}_i^{(t-1)} + f_t(x_i)) + \Omega(f_t) + constant$</p> <ul><li><p><strong>训练损失项</strong>  $L(y_i, \hat{y}_i^{(t-1)} + f_t(x_i))$ ：衡量预测值与真实值的差异，如回归用MSE、分类用对数损失等。</p></li> <li><p><strong>正则化项</strong>  $\Omega(f_t) = \gamma T + \frac{1}{2}\lambda \sum_{j=1}^T w_j^2$ ：控制树复杂度， $\gamma$  是叶节点数量惩罚系数， $T$  为叶节点数， $\lambda$  是叶节点权重的L2正则系数， $w_j$  是第  $j$  个叶节点的输出权重。</p></li></ul> <p>为高效优化目标函数，XGBoost对损失项在  $\hat{y}_i^{(t-1)}$  处做<strong>二阶泰勒展开</strong>，并保留常数项，目标函数可简化为：</p> <p>$Obj^{(t)} \approx \sum_{i=1}^n [g_i f_t(x_i) + \frac{1}{2} h_i f_t^2(x_i)] + \gamma T + \frac{1}{2}\lambda \sum_{j=1}^T w_j^2$</p> <p>其中， $g_i = \partial_{\hat{y}_i^{(t-1)}} L(y_i, \hat{y}<em>i^{(t-1)})$ （一阶梯度）， $h_i = \partial</em>{\hat{y}_i^{(t-1)}}^2 L(y_i, \hat{y}_i^{(t-1)})$ （二阶梯度）。该近似让每棵树的训练可快速求解，且精度高于仅用一阶梯度的传统GBDT。</p> <p>进一步假设树的结构固定（即样本到叶节点的映射固定），将样本按叶节点分组，令  $I_j = {i | f_t(x_i) = w_j}$  表示第  $j$  个叶节点对应的样本集合，目标函数可转化为叶节点权重的函数，最优叶节点权重  $w_j^* = -\frac{\sum_{i \in I_j} g_i}{\sum_{i \in I_j} h_i + \lambda}$ ，代入后目标函数的最小值为  $-\frac{1}{2} \sum_{j=1}^T \frac{(\sum_{i \in I_j} g_i)^2}{\sum_{i \in I_j} h_i + \lambda} + \gamma T$ 。</p> <hr> <h3 id="三、树的构建与分裂策略"><a href="#三、树的构建与分裂策略" class="header-anchor">#</a> 三、树的构建与分裂策略</h3> <p>树的构建采用<strong>贪心算法</strong>，递归选择最优分裂点以最大化目标函数增益，核心步骤如下：</p> <ol><li><p>初始化叶节点，计算所有样本的  $g_i$  和  $h_i$  总和。</p></li> <li><p>遍历每个特征及可能的分裂点，计算分裂前后的目标函数差值（即增益）：</p></li></ol> <p>$Gain = \frac{1}{2} \left[ \frac{(\sum_{L} g_i)^2}{\sum_{L} h_i + \lambda} + \frac{(\sum_{R} g_i)^2}{\sum_{R} h_i + \lambda} - \frac{(\sum_{all} g_i)^2}{\sum_{all} h_i + \lambda} \right] - \gamma$</p> <p>其中， $\sum_L$ 、 $\sum_R$  分别是分裂后左、右子节点的梯度和。</p> <ol><li><p>选择增益最大的分裂点进行节点分裂；若最大增益小于0，则停止分裂（剪枝）。</p></li> <li><p>重复上述步骤，直至达到最大树深、最小样本权重和等约束条件。</p></li></ol> <p>此外，XGBoost支持<strong>近似分裂算法</strong>（分桶找候选分裂点）和<strong>列采样</strong>（每轮训练仅用部分特征），平衡训练效率与模型泛化性。</p> <hr> <h3 id="四、关键特性与工程优化"><a href="#四、关键特性与工程优化" class="header-anchor">#</a> 四、关键特性与工程优化</h3> <ol><li><p><strong>稀疏感知与缺失值处理</strong>：训练时自动学习缺失值的最优划分方向，预测时将缺失值分配到默认方向，适配稀疏数据场景。</p></li> <li><p><strong>并行化优化</strong>：以“列块”存储特征，在树节点分裂时并行计算各特征的分裂增益，提升训练速度；支持CPU多线程并行与分布式训练。</p></li> <li><p><strong>缓存优化</strong>：将样本梯度与特征值缓存对齐，减少内存访问开销，提升计算效率。</p></li> <li><p><strong>剪枝策略</strong>：通过正则化与分裂增益阈值（ $\gamma$ ）实现预剪枝，避免过拟合。</p></li></ol> <hr> <h3 id="五、预测与模型输出"><a href="#五、预测与模型输出" class="header-anchor">#</a> 五、预测与模型输出</h3> <p>预测时，输入样本在每棵树中遍历到对应的叶节点，累加所有叶节点的权重值，结合学习率  $\eta$ （收缩系数）得到最终预测结果： $\hat{y} = \sum_{t=1}^T \eta f_t(x)$ ， $\eta$  用于降低单棵树的影响，提升模型鲁棒性。</p> <hr> <h3 id="核心原理对比-xgboost-vs-传统gbdt"><a href="#核心原理对比-xgboost-vs-传统gbdt" class="header-anchor">#</a> 核心原理对比（XGBoost vs 传统GBDT）</h3> <table><thead><tr><th>特性</th> <th>XGBoost</th> <th>传统GBDT</th></tr></thead> <tbody><tr><td>梯度利用</td> <td>一阶+二阶梯度（二阶泰勒展开）</td> <td>仅一阶梯度</td></tr> <tr><td>正则化</td> <td>L1+L2+叶节点数惩罚</td> <td>弱正则或无显式正则</td></tr> <tr><td>缺失值处理</td> <td>稀疏感知，自动学习划分方向</td> <td>需手动填充缺失值</td></tr> <tr><td>并行能力</td> <td>支持特征并行、分布式训练</td> <td>串行训练，无并行优化</td></tr> <tr><td>分裂策略</td> <td>精确/近似分裂+列采样</td> <td>贪心精确分裂</td></tr></tbody></table> <p>需要我基于上述原理，提供一份可直接运行的<strong>XGBoost分类/回归示例代码</strong>（含参数注释与结果评估）吗？</p> <h2 id="xgboost-的安装"><a href="#xgboost-的安装" class="header-anchor">#</a> XGBoost 的安装</h2> <p>此次学习中，我们将通过jupyter notebook 来演示XGBoost的使用。所以我们需要安装以下库：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>pip <span class="token function">install</span> pandas numpy scikit-learn xgboost matplotlib seaborn jupyter
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="xgboost-2"><a href="#xgboost-2" class="header-anchor">#</a> xgboost</h3> <ol><li>用途：高效实现梯度提升决策树（Gradient Boosting）的库。</li> <li>特点：
<ul><li>性能优异，在很多 Kaggle 比赛中表现突出。</li> <li>支持分类、回归、排序等任务。</li> <li>可处理缺失值、支持并行计算、提供正则化防止过拟合。</li></ul></li></ol> <h3 id="jupyter"><a href="#jupyter" class="header-anchor">#</a> jupyter</h3> <ol><li>用途：交互式开发环境（通常指 Jupyter Notebook 或 JupyterLab）。</li> <li>特点：
<ul><li>允许在浏览器中编写和运行代码块（cell），即时查看结果。</li> <li>支持 Markdown 文档、公式、图片嵌入，非常适合教学、探索性数据分析和报告撰写。</li> <li>广泛用于数据科学、机器学习等领域。</li></ul></li></ol> <h3 id="pandas"><a href="#pandas" class="header-anchor">#</a> pandas</h3> <ol><li>用途：用于数据处理和分析。</li> <li>特点：
<ul><li>提供 DataFrame 和 Series 数据结构，便于操作表格型或异构型数据。</li> <li>支持读写 CSV、Excel、SQL 等多种格式。</li> <li>强大的数据清洗、筛选、聚合功能。</li></ul></li></ol> <h3 id="numpy"><a href="#numpy" class="header-anchor">#</a> numpy</h3> <ol><li>用途：用于科学计算的基础库。</li> <li>特点：
<ul><li>提供高性能的多维数组对象（ndarray）。</li> <li>支持广播、向量化运算、线性代数、随机数生成等。</li> <li>是 pandas、scikit-learn 等库的底层依赖。</li></ul></li></ol> <h3 id="scikit-learn"><a href="#scikit-learn" class="header-anchor">#</a> scikit-learn</h3> <ol><li>用途：经典的机器学习库。</li> <li>特点：
<ul><li>提供大量监督/无监督学习算法（如线性回归、SVM、KMeans、决策树等）。</li> <li>包含模型评估、交叉验证、数据预处理、特征选择等工具。</li> <li>接口统一、文档完善，适合初学者和工业应用。</li></ul></li></ol> <h3 id="matplotlib"><a href="#matplotlib" class="header-anchor">#</a> matplotlib</h3> <ol><li>用途：Python 最基础的绘图库。</li> <li>特点：
<ul><li>可绘制折线图、散点图、柱状图、直方图等。</li> <li>高度可定制（颜色、标签、图例、坐标轴等）。</li> <li>是许多高级可视化库（如 seaborn）的底层依赖。</li></ul></li></ol> <h3 id="seaborn"><a href="#seaborn" class="header-anchor">#</a> seaborn</h3> <ol><li>用途：基于 matplotlib 的高级统计可视化库。</li> <li>特点：
<ul><li>语法更简洁，适合快速绘制美观的统计图表（如热力图、分布图、箱线图等）。</li> <li>内置配色方案和样式，图形默认更“好看”。</li> <li>与 pandas DataFrame 无缝集成。</li></ul></li></ol> <h2 id="学习场景"><a href="#学习场景" class="header-anchor">#</a> 学习场景</h2> <p>先启动<code>jupyter notebook</code>, 然后创建一个新的notebook（<code>file-&gt;new-&gt;notebook-&gt;python 3</code>）</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># 启动</span>
jupyter notebook
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>注意：每个单元格输入完成后，点击运行按钮（或按 Shift + Enter）执行代码。</strong></p> <h3 id="场景1-泰坦尼克号生存预测"><a href="#场景1-泰坦尼克号生存预测" class="header-anchor">#</a> 场景1：泰坦尼克号生存预测</h3> <h4 id="完整代码"><a href="#完整代码" class="header-anchor">#</a> 完整代码</h4> <details><summary><b>详细代码</b></summary> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># 1. 导入库</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score<span class="token punctuation">,</span> classification_report
<span class="token keyword">import</span> xgboost <span class="token keyword">as</span> xgb

<span class="token comment"># 2. 加载数据（确保 train.csv 在当前目录）</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./数据/train.csv'</span><span class="token punctuation">)</span>

<span class="token comment"># 3. 查看基本信息（可选）</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;数据形状:&quot;</span><span class="token punctuation">,</span> df<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n缺失值统计:&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 4. 特征工程与预处理</span>

<span class="token comment"># 删除无关列</span>
df_clean <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'PassengerId'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Ticket'</span><span class="token punctuation">,</span> <span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 填充缺失值（不再使用 inplace=True）</span>
df_clean<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>df_clean<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 编码分类变量</span>
df_clean<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'male'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span> <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 创建新特征</span>
df_clean<span class="token punctuation">[</span><span class="token string">'FamilySize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'SibSp'</span><span class="token punctuation">]</span> <span class="token operator">+</span> df_clean<span class="token punctuation">[</span><span class="token string">'Parch'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
df_clean<span class="token punctuation">[</span><span class="token string">'IsAlone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>df_clean<span class="token punctuation">[</span><span class="token string">'FamilySize'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>

<span class="token comment"># 5. 准备特征 X 和标签 y</span>
X <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Pclass'</span><span class="token punctuation">,</span> <span class="token string">'Sex'</span><span class="token punctuation">,</span> <span class="token string">'Age'</span><span class="token punctuation">,</span> <span class="token string">'SibSp'</span><span class="token punctuation">,</span> <span class="token string">'Parch'</span><span class="token punctuation">,</span> <span class="token string">'Fare'</span><span class="token punctuation">,</span> <span class="token string">'Embarked'</span><span class="token punctuation">,</span> <span class="token string">'FamilySize'</span><span class="token punctuation">,</span> <span class="token string">'IsAlone'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span>

<span class="token comment"># 6. 划分训练集和测试集</span>
X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>y
<span class="token punctuation">)</span>

<span class="token comment"># 7. 训练 XGBoost 模型</span>
model <span class="token operator">=</span> xgb<span class="token punctuation">.</span>XGBClassifier<span class="token punctuation">(</span>
    n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
    max_depth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>
    random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span>
    eval_metric<span class="token operator">=</span><span class="token string">'logloss'</span>
<span class="token punctuation">)</span>

model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

<span class="token comment"># 8. 预测与评估</span>
y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n=== 模型评估 ===&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;准确率:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n分类报告:&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div></details> <h4 id="单元格-1-导入库-确保已安装"><a href="#单元格-1-导入库-确保已安装" class="header-anchor">#</a> 单元格 1：导入库（确保已安装）</h4> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> accuracy_score<span class="token punctuation">,</span> classification_report<span class="token punctuation">,</span> confusion_matrix
<span class="token keyword">import</span> xgboost <span class="token keyword">as</span> xgb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="单元格-2-加载数据"><a href="#单元格-2-加载数据" class="header-anchor">#</a> 单元格 2：加载数据</h4> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># 读取本地 CSV 文件</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./数据/train.csv'</span><span class="token punctuation">)</span>  <span class="token comment"># 假设文件名是 titanic.csv，放在当前目录下</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;数据形状:&quot;</span><span class="token punctuation">,</span> df<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="单元格-3-数据预处理"><a href="#单元格-3-数据预处理" class="header-anchor">#</a> 单元格 3：数据预处理</h4> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># 删除无关列</span>
df_clean <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'PassengerId'</span><span class="token punctuation">,</span> <span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Ticket'</span><span class="token punctuation">,</span> <span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 填充缺失值（不再使用 inplace=True）</span>
df_clean<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>df_clean<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 编码分类变量</span>
df_clean<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'male'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span> <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>df_clean<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 创建新特征</span>
df_clean<span class="token punctuation">[</span><span class="token string">'FamilySize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'SibSp'</span><span class="token punctuation">]</span> <span class="token operator">+</span> df_clean<span class="token punctuation">[</span><span class="token string">'Parch'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
df_clean<span class="token punctuation">[</span><span class="token string">'IsAlone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>df_clean<span class="token punctuation">[</span><span class="token string">'FamilySize'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>

<span class="token comment"># 查看结果</span>
df_clean<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="单元格-4-准备训练数据"><a href="#单元格-4-准备训练数据" class="header-anchor">#</a> 单元格 4：准备训练数据</h4> <div class="language-py line-numbers-mode"><pre class="language-py"><code>X <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Pclass'</span><span class="token punctuation">,</span> <span class="token string">'Sex'</span><span class="token punctuation">,</span> <span class="token string">'Age'</span><span class="token punctuation">,</span> <span class="token string">'SibSp'</span><span class="token punctuation">,</span> <span class="token string">'Parch'</span><span class="token punctuation">,</span> <span class="token string">'Fare'</span><span class="token punctuation">,</span> <span class="token string">'Embarked'</span><span class="token punctuation">,</span> <span class="token string">'FamilySize'</span><span class="token punctuation">,</span> <span class="token string">'IsAlone'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> df_clean<span class="token punctuation">[</span><span class="token string">'Survived'</span><span class="token punctuation">]</span>

X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>
    X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span> stratify<span class="token operator">=</span>y
<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;训练集大小:&quot;</span><span class="token punctuation">,</span> X_train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;测试集大小:&quot;</span><span class="token punctuation">,</span> X_test<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="单元格-5-训练模型"><a href="#单元格-5-训练模型" class="header-anchor">#</a> 单元格 5：训练模型</h4> <div class="language-py line-numbers-mode"><pre class="language-py"><code>model <span class="token operator">=</span> xgb<span class="token punctuation">.</span>XGBClassifier<span class="token punctuation">(</span>
    n_estimators<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
    max_depth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span>
    random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span>
    eval_metric<span class="token operator">=</span><span class="token string">'logloss'</span>
<span class="token punctuation">)</span>

model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="单元格-6-评估结果"><a href="#单元格-6-评估结果" class="header-anchor">#</a> 单元格 6：评估结果</h4> <div class="language-py line-numbers-mode"><pre class="language-py"><code>y_pred <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;准确率:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">round</span><span class="token punctuation">(</span>accuracy_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n分类报告:&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>成功后会输出类似结果：</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>准确率: 0.6257

分类报告:
              precision    recall  f1-score   support

           0       0.68      0.74      0.71       110
           1       0.52      0.45      0.48        69

    accuracy                           0.63       179
   macro avg       0.60      0.59      0.59       179
weighted avg       0.62      0.63      0.62       179
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="保存notebook"><a href="#保存notebook" class="header-anchor">#</a> 保存Notebook</h4> <ol><li>点击菜单栏 File → Save and Checkpoint</li> <li>或按快捷键 Ctrl + S（Windows） / Cmd + S（Mac）</li></ol> <h2 id="导出模型"><a href="#导出模型" class="header-anchor">#</a> 导出模型</h2> <p>训练好的模型可以直接保存为 <code>.ubj</code> 文件，后续加载时无需重新训练。<strong>注意：不要直接保存为 <code>.json</code> 文件，因为 XGBoost 模型的 <code>.json</code> 文件包含了模型的元数据且会报错，而 <code>.ubj</code> 文件则是二进制格式，更轻量级。</strong></p> <p>导出模型时，需要在之前训练模型的代码后添加以下代码：（<strong>可以直接跟在训练模型的代码后面也可以单独放在一个单元格中，前提是都需要重头运行一遍</strong>）</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># 直接保存为 .ubj（假设 model 是 XGBClassifier）</span>
booster <span class="token operator">=</span> model<span class="token punctuation">.</span>get_booster<span class="token punctuation">(</span><span class="token punctuation">)</span>
booster<span class="token punctuation">.</span>save_model<span class="token punctuation">(</span><span class="token string">'titanic_xgboost.ubj'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;✅ 模型已导出为 titanic_xgboost.ubj&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="使用导出的模型"><a href="#使用导出的模型" class="header-anchor">#</a> 使用导出的模型</h2> <p>导出模型后，后续可以直接加载模型进行预测，无需重新训练。以下是加载模型的代码：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">import</span> xgboost <span class="token keyword">as</span> xgb

<span class="token comment"># 加载导出的模型</span>
booster <span class="token operator">=</span> xgb<span class="token punctuation">.</span>Booster<span class="token punctuation">(</span><span class="token punctuation">)</span>
booster<span class="token punctuation">.</span>load_model<span class="token punctuation">(</span><span class="token string">'titanic_xgboost.ubj'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;✅ 模型已加载&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><details><summary><b>配套的完整代码如下：</b></summary> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># predict_from_ubj.py</span>
<span class="token comment"># 功能：加载已有的 .ubj 模型 → 预测 test.csv → 生成 submission.csv</span>

<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> xgboost <span class="token keyword">as</span> xgb
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder

<span class="token comment"># ----------------------------</span>
<span class="token comment"># 1. 定义与训练时完全一致的特征工程函数</span>
<span class="token comment"># ----------------------------</span>
<span class="token keyword">def</span> <span class="token function">preprocess_test</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    对测试集进行与训练集完全相同的预处理
    &quot;&quot;&quot;</span>
    df <span class="token operator">=</span> df<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 删除无关列（保留 PassengerId 用于提交）</span>
    df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">,</span> <span class="token string">'Ticket'</span><span class="token punctuation">,</span> <span class="token string">'Cabin'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 填充缺失值（必须与训练时一致！）</span>
    df<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'Age'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    df<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'Fare'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># test.csv 中 Fare 可能缺失</span>
    df<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">)</span>  <span class="token comment"># 训练时用的众数是 'S'</span>
    
    <span class="token comment"># 编码分类变量（必须与训练时一致！）</span>
    df<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Sex'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'male'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'female'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Embarked 编码：S=0, C=1, Q=2（需与训练时顺序一致）</span>
    embarked_map <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'S'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'Q'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
    df<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'Embarked'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>embarked_map<span class="token punctuation">)</span>
    
    <span class="token comment"># 创建新特征（必须与训练时一致！）</span>
    df<span class="token punctuation">[</span><span class="token string">'FamilySize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'SibSp'</span><span class="token punctuation">]</span> <span class="token operator">+</span> df<span class="token punctuation">[</span><span class="token string">'Parch'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
    df<span class="token punctuation">[</span><span class="token string">'IsAlone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'FamilySize'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> df

<span class="token comment"># ----------------------------</span>
<span class="token comment"># 2. 加载测试数据</span>
<span class="token comment"># ----------------------------</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;📥 加载测试数据...&quot;</span><span class="token punctuation">)</span>
test_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./数据/test.csv'</span><span class="token punctuation">)</span>
passenger_ids <span class="token operator">=</span> test_df<span class="token punctuation">[</span><span class="token string">'PassengerId'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 保留原始 ID</span>

<span class="token comment"># ----------------------------</span>
<span class="token comment"># 3. 特征工程</span>
<span class="token comment"># ----------------------------</span>
test_clean <span class="token operator">=</span> preprocess_test<span class="token punctuation">(</span>test_df<span class="token punctuation">)</span>

<span class="token comment"># 确保特征顺序与训练时完全一致！</span>
feature_columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Pclass'</span><span class="token punctuation">,</span> <span class="token string">'Sex'</span><span class="token punctuation">,</span> <span class="token string">'Age'</span><span class="token punctuation">,</span> <span class="token string">'SibSp'</span><span class="token punctuation">,</span> <span class="token string">'Parch'</span><span class="token punctuation">,</span> <span class="token string">'Fare'</span><span class="token punctuation">,</span> <span class="token string">'Embarked'</span><span class="token punctuation">,</span> <span class="token string">'FamilySize'</span><span class="token punctuation">,</span> <span class="token string">'IsAlone'</span><span class="token punctuation">]</span>
X_test <span class="token operator">=</span> test_clean<span class="token punctuation">[</span>feature_columns<span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;✅ 测试集形状: </span><span class="token interpolation"><span class="token punctuation">{</span>X_test<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># ----------------------------</span>
<span class="token comment"># 4. 加载 .ubj 模型</span>
<span class="token comment"># ----------------------------</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;🔄 加载模型 titanic_xgboost.ubj ...&quot;</span><span class="token punctuation">)</span>
model <span class="token operator">=</span> xgb<span class="token punctuation">.</span>Booster<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>load_model<span class="token punctuation">(</span><span class="token string">'titanic_xgboost.ubj'</span><span class="token punctuation">)</span>  <span class="token comment"># 支持 .ubj 和 .json</span>

<span class="token comment"># ----------------------------</span>
<span class="token comment"># 5. 预测</span>
<span class="token comment"># ----------------------------</span>
dtest <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
y_pred_proba <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>dtest<span class="token punctuation">)</span>
y_pred <span class="token operator">=</span> <span class="token punctuation">(</span>y_pred_proba <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>  <span class="token comment"># 二分类阈值</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;✅ 预测完成，正类比例: </span><span class="token interpolation"><span class="token punctuation">{</span>y_pred<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2%</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token comment"># ----------------------------</span>
<span class="token comment"># 6. 生成提交文件</span>
<span class="token comment"># ----------------------------</span>
submission <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'PassengerId'</span><span class="token punctuation">:</span> passenger_ids<span class="token punctuation">,</span>
    <span class="token string">'Survived'</span><span class="token punctuation">:</span> y_pred
<span class="token punctuation">}</span><span class="token punctuation">)</span>

submission<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'submission.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;🎉 提交文件已保存为 submission.csv&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 可选：打印前几行</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n📄 提交文件预览:&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>submission<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br></div></div></details></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/article/Python/Crawler.html" class="prev">
        Crawler爬虫
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.8527b2d6.js" defer></script><script src="/blog/assets/js/2.68d50f3f.js" defer></script><script src="/blog/assets/js/1.0e421e36.js" defer></script><script src="/blog/assets/js/45.c63b273c.js" defer></script>
  </body>
</html>
