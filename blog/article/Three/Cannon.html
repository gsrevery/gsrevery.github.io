<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>cannon.js | gp&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="学而时习之不亦说乎，有朋至远方来不亦乐乎。">
    
    <link rel="preload" href="/blog/assets/css/0.styles.e32d6808.css" as="style"><link rel="preload" href="/blog/assets/js/app.95d1cef2.js" as="script"><link rel="preload" href="/blog/assets/js/2.dd56d6fa.js" as="script"><link rel="preload" href="/blog/assets/js/1.05d0606b.js" as="script"><link rel="preload" href="/blog/assets/js/31.a2ef508f.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.d6c6ae10.js"><link rel="prefetch" href="/blog/assets/js/11.76751111.js"><link rel="prefetch" href="/blog/assets/js/12.3f432822.js"><link rel="prefetch" href="/blog/assets/js/13.659f6263.js"><link rel="prefetch" href="/blog/assets/js/14.b7d50a96.js"><link rel="prefetch" href="/blog/assets/js/15.f2ea1e73.js"><link rel="prefetch" href="/blog/assets/js/16.e1b887ae.js"><link rel="prefetch" href="/blog/assets/js/17.3c6d46a7.js"><link rel="prefetch" href="/blog/assets/js/18.6933475c.js"><link rel="prefetch" href="/blog/assets/js/19.e4b19d88.js"><link rel="prefetch" href="/blog/assets/js/20.ff3cf5e0.js"><link rel="prefetch" href="/blog/assets/js/21.da843f56.js"><link rel="prefetch" href="/blog/assets/js/22.88ae7534.js"><link rel="prefetch" href="/blog/assets/js/23.ef58a1cf.js"><link rel="prefetch" href="/blog/assets/js/24.015b2e47.js"><link rel="prefetch" href="/blog/assets/js/25.b9ea98ae.js"><link rel="prefetch" href="/blog/assets/js/26.afff07f5.js"><link rel="prefetch" href="/blog/assets/js/27.4f749e22.js"><link rel="prefetch" href="/blog/assets/js/28.db5dceeb.js"><link rel="prefetch" href="/blog/assets/js/29.424d615d.js"><link rel="prefetch" href="/blog/assets/js/3.1fe88f52.js"><link rel="prefetch" href="/blog/assets/js/30.55370f33.js"><link rel="prefetch" href="/blog/assets/js/32.e41c0b91.js"><link rel="prefetch" href="/blog/assets/js/33.006146e5.js"><link rel="prefetch" href="/blog/assets/js/34.d5412c8a.js"><link rel="prefetch" href="/blog/assets/js/35.4d4bdb76.js"><link rel="prefetch" href="/blog/assets/js/36.da619ea8.js"><link rel="prefetch" href="/blog/assets/js/37.011124d2.js"><link rel="prefetch" href="/blog/assets/js/38.6e156ef0.js"><link rel="prefetch" href="/blog/assets/js/39.00ba53dc.js"><link rel="prefetch" href="/blog/assets/js/4.f354b7a5.js"><link rel="prefetch" href="/blog/assets/js/40.0699260a.js"><link rel="prefetch" href="/blog/assets/js/41.5834c084.js"><link rel="prefetch" href="/blog/assets/js/42.711c5521.js"><link rel="prefetch" href="/blog/assets/js/43.44528f35.js"><link rel="prefetch" href="/blog/assets/js/44.da96ff0e.js"><link rel="prefetch" href="/blog/assets/js/45.8dd701e9.js"><link rel="prefetch" href="/blog/assets/js/46.585555a0.js"><link rel="prefetch" href="/blog/assets/js/47.c0938123.js"><link rel="prefetch" href="/blog/assets/js/48.f3664d9d.js"><link rel="prefetch" href="/blog/assets/js/49.a489ca1f.js"><link rel="prefetch" href="/blog/assets/js/5.cd1a2312.js"><link rel="prefetch" href="/blog/assets/js/50.ea2493a2.js"><link rel="prefetch" href="/blog/assets/js/51.59649d9f.js"><link rel="prefetch" href="/blog/assets/js/52.a8f9c310.js"><link rel="prefetch" href="/blog/assets/js/53.f6e7ba1a.js"><link rel="prefetch" href="/blog/assets/js/54.1b302df0.js"><link rel="prefetch" href="/blog/assets/js/55.31623364.js"><link rel="prefetch" href="/blog/assets/js/56.a727b56c.js"><link rel="prefetch" href="/blog/assets/js/57.fc50f9fe.js"><link rel="prefetch" href="/blog/assets/js/58.83bdfda3.js"><link rel="prefetch" href="/blog/assets/js/59.a935ae25.js"><link rel="prefetch" href="/blog/assets/js/6.21902164.js"><link rel="prefetch" href="/blog/assets/js/60.2640c0e6.js"><link rel="prefetch" href="/blog/assets/js/61.1c66210c.js"><link rel="prefetch" href="/blog/assets/js/62.ec487adf.js"><link rel="prefetch" href="/blog/assets/js/63.8029a8bf.js"><link rel="prefetch" href="/blog/assets/js/64.4db62b40.js"><link rel="prefetch" href="/blog/assets/js/65.5f9ee2be.js"><link rel="prefetch" href="/blog/assets/js/66.50270f75.js"><link rel="prefetch" href="/blog/assets/js/67.6658d81f.js"><link rel="prefetch" href="/blog/assets/js/68.629a4ae1.js"><link rel="prefetch" href="/blog/assets/js/69.3a46e860.js"><link rel="prefetch" href="/blog/assets/js/7.2b89de10.js"><link rel="prefetch" href="/blog/assets/js/70.5e912eac.js"><link rel="prefetch" href="/blog/assets/js/71.1640dba1.js"><link rel="prefetch" href="/blog/assets/js/72.32d6a03f.js"><link rel="prefetch" href="/blog/assets/js/73.63ed6547.js"><link rel="prefetch" href="/blog/assets/js/74.30db84d2.js"><link rel="prefetch" href="/blog/assets/js/75.44ed3954.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.e2498148.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.e32d6808.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">gp's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/article/JavaScript/Rule.html" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/blog/AboutMe.html" class="nav-link">
  Resume
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/article/JavaScript/Rule.html" class="nav-link">
  Blog
</a></div><div class="nav-item"><a href="/blog/AboutMe.html" class="nav-link">
  Resume
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/JavaScript/Optimization.html" class="sidebar-link">优化</a></li><li><a href="/blog/article/JavaScript/Rule.html" class="sidebar-link">代码规范</a></li><li><a href="/blog/article/JavaScript/QA-daily.html" class="sidebar-link">练习题目</a></li><li><a href="/blog/article/JavaScript/Object.html" class="sidebar-link">对象</a></li><li><a href="/blog/article/JavaScript/Array.html" class="sidebar-link">数组</a></li><li><a href="/blog/article/JavaScript/Function.html" class="sidebar-link">函数</a></li><li><a href="/blog/article/JavaScript/Ram.html" class="sidebar-link">内存</a></li><li><a href="/blog/article/JavaScript/Method.html" class="sidebar-link">常用方法</a></li><li><a href="/blog/article/JavaScript/PublicFunction.html" class="sidebar-link">公共方法</a></li><li><a href="/blog/article/JavaScript/Robustness.html" class="sidebar-link">代码健壮性</a></li><li><a href="/blog/article/JavaScript/Tree.html" class="sidebar-link">树</a></li><li><a href="/blog/article/JavaScript/This.html" class="sidebar-link">this指向</a></li><li><a href="/blog/article/JavaScript/EventLoop.html" class="sidebar-link">事件循环机制</a></li><li><a href="/blog/article/JavaScript/CrossDomain.html" class="sidebar-link">跨域</a></li><li><a href="/blog/article/JavaScript/Bubble.html" class="sidebar-link">冒泡</a></li><li><a href="/blog/article/JavaScript/CommonlyMethod.html" class="sidebar-link">数据特殊处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Css/Css.html" class="sidebar-link">css</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Vue/Components.html" class="sidebar-link">组件</a></li><li><a href="/blog/article/Vue/CrossDomain.html" class="sidebar-link">跨域</a></li><li><a href="/blog/article/Vue/Reconstruction.html" class="sidebar-link">项目重构优化</a></li><li><a href="/blog/article/Vue/Question.html" class="sidebar-link">vue问题</a></li><li><a href="/blog/article/Vue/FileHandle.html" class="sidebar-link">文件处理</a></li><li><a href="/blog/article/Vue/Router.html" class="sidebar-link">路由</a></li><li><a href="/blog/article/Vue/Table.html" class="sidebar-link">表格</a></li><li><a href="/blog/article/Vue/SpecialPage.html" class="sidebar-link">页面</a></li><li><a href="/blog/article/Vue/Seo.html" class="sidebar-link">SEO优化</a></li><li><a href="/blog/article/Vue/Package.html" class="sidebar-link">package配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>App</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/APP/UniApp.html" class="sidebar-link">uni-app</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Other</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Other/Git.html" class="sidebar-link">git操作</a></li><li><a href="/blog/article/Other/Canvas.html" class="sidebar-link">canvas</a></li><li><a href="/blog/article/Other/Qiankun.html" class="sidebar-link">qiankun</a></li><li><a href="/blog/article/Other/LODOP.html" class="sidebar-link">lodop插件</a></li><li><a href="/blog/article/Other/Npm.html" class="sidebar-link">npm私有库</a></li><li><a href="/blog/article/Other/Interview.html" class="sidebar-link">问题总结</a></li><li><a href="/blog/article/Other/ProjectLssues.html" class="sidebar-link">运行项目问题</a></li><li><a href="/blog/article/Other/OnlinePayment.html" class="sidebar-link">在线支付</a></li><li><a href="/blog/article/Other/PluginUnit.html" class="sidebar-link">js常用的各种插件</a></li><li><a href="/blog/article/Other/Vscode.html" class="sidebar-link">vscode常用插件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Three</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Three/Overview.html" class="sidebar-link">Three概览</a></li><li><a href="/blog/article/Three/Optimize.html" class="sidebar-link">Three性能优化</a></li><li><a href="/blog/article/Three/IntelligentPackingFunction.html" class="sidebar-link">Three常见问题及解决方案</a></li><li><a href="/blog/article/Three/Cannon.html" aria-current="page" class="active sidebar-link">Cannon物理引擎</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/Three/Cannon.html#参考资料" class="sidebar-link">参考资料</a></li><li class="sidebar-sub-header"><a href="/blog/article/Three/Cannon.html#物理模型" class="sidebar-link">物理模型</a></li><li class="sidebar-sub-header"><a href="/blog/article/Three/Cannon.html#使用示例" class="sidebar-link">使用示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/article/Three/Cannon.html#自动碰撞检测场景" class="sidebar-link">自动碰撞检测场景</a></li><li class="sidebar-sub-header"><a href="/blog/article/Three/Cannon.html#拖拽碰撞检测场景" class="sidebar-link">拖拽碰撞检测场景</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/article/Python/Grammar.html" class="sidebar-link">Grammar</a></li><li><a href="/blog/article/Python/PySide6.html" class="sidebar-link">PySide6</a></li><li><a href="/blog/article/Python/Use.html" class="sidebar-link">Use</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="cannon-js"><a href="#cannon-js" class="header-anchor">#</a> cannon.js</h1> <p>Cannon.js 是一个开源的物理引擎，专为WebGL和游戏开发设计，尤其适合与Three.js这样的3D渲染库搭配使用</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <p><a href="/blog/article/Three/[https:/pmndrs.github.io/cannon-es/"><strong>官方英文文档</strong></a>: https://pmndrs.github.io/cannon-es/</p> <p><a href="%5Bhttps://www.npmjs.com/package/cannon-es"><strong>npm地址</strong></a>: https://www.npmjs.com/package/cannon-es</p> <h2 id="物理模型"><a href="#物理模型" class="header-anchor">#</a> 物理模型</h2> <ul><li><ol><li><strong>球体（Sphere）:</strong> 通过 CANNON.Sphere 类创建，只需指定球体的半径。</li></ol></li> <li><ol start="2"><li>盒子（Box）: 使用 CANNON.Box 创建，需要提供一个表示宽度、长度和高度的三维向量。</li></ol></li> <li><ol start="3"><li><strong>平面（Plane）:</strong> 虽然没有直接的平面形状，但可以通过创建一个具有足够大尺寸的 CANNON.Box 或非常薄的 CANNON.Trimesh 来模拟。</li></ol></li> <li><ol start="4"><li><strong>长方体（Box）:</strong> 实际上与盒子相同，通过 CANNON.Box 创建。</li></ol></li> <li><ol start="5"><li><strong>圆柱体（近似）:</strong> Cannon.js没有直接的圆柱体形状，但你可以通过组合两个半球和一个长方体来近似模拟。</li></ol></li> <li><ol start="6"><li><strong>三角形网格（Trimesh）:</strong> 使用 CANNON.Trimesh 可以创建复杂的不规则形状，适用于从三维模型导出的精确几何形状。</li></ol></li> <li><ol start="7"><li><strong>复合形状（Compound）:</strong> 如果需要组合多个基本形状来创建更复杂的物体，可以使用 CANNON.Compound。</li></ol></li> <li><ol start="8"><li><strong>粒子（Particle）:</strong> 通过 CANNON.Particle 可以创建没有体积的点状物体，常用于质点模拟。</li></ol></li> <li><ol start="9"><li><strong>刚体（Rigidbody）:</strong> CANNON.Body 是所有物理对象的基础类，包含了质量、位置、旋转等属性，并且可以附加上述任何形状。</li></ol></li> <li><ol start="10"><li><strong>锥体（无直接支持）:</strong> 类似圆柱体，Cannon.js没有直接的锥体形状，但可以通过创造性的形状组合来近似。</li></ol></li></ul> <h2 id="使用示例"><a href="#使用示例" class="header-anchor">#</a> 使用示例</h2> <h3 id="自动碰撞检测场景"><a href="#自动碰撞检测场景" class="header-anchor">#</a> 自动碰撞检测场景</h3> <details><summary><b>代码及效果展示</b></summary> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>utf-8</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>cannon.js自动碰撞<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../common.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 这里是本地js，使用时需要更改地址 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/three.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/DragControls.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/GLTFLoader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/OrbitControls.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token comment">/**
   * 3D场景中进行平移，在不旋转的情况下，只看到物体跟随鼠标以平行于窗口的轨迹运动
*/</span>
<span class="token keyword">let</span> renderer<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> scene<span class="token punctuation">,</span>
    light<span class="token punctuation">,</span> mesh<span class="token punctuation">,</span>
    cameraControls<span class="token punctuation">,</span>
	group1<span class="token punctuation">,</span> group2<span class="token punctuation">,</span> model<span class="token punctuation">,</span>
	cubeShape1<span class="token punctuation">,</span> cubeBody1<span class="token punctuation">,</span> cubeShape2<span class="token punctuation">,</span> cubeBody2<span class="token punctuation">;</span>
<span class="token keyword">let</span> xyz <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token literal-property property">z</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建物理引擎世界</span>
<span class="token keyword">let</span> world <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>World</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// world.gravity.set(0, -9.82, 0);</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化渲染器</span>
    <span class="token function">initScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化场景</span>
    <span class="token function">initLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化光</span>
    <span class="token function">initCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化相机</span>
    <span class="token keyword">await</span> <span class="token function">initMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化模型</span>
	<span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>onresize <span class="token operator">=</span> onWindowResize<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">//初始化渲染器</span>
  <span class="token keyword">function</span> <span class="token function">initRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
	renderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token string">'#fff'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//初始化场景</span>
  <span class="token keyword">function</span> <span class="token function">initScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 创建3维坐标系</span>
	<span class="token keyword">let</span> AxesHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AxesHelper</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
	scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>AxesHelper<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//初始化相机</span>
  <span class="token keyword">function</span> <span class="token function">initCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//x,y,z</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//初始化光</span>
  <span class="token keyword">function</span> <span class="token function">initLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AmbientLight</span><span class="token punctuation">(</span><span class="token number">0x444444</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    light<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//平行光开启阴影投射</span>
    light<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

   
	<span class="token keyword">function</span> <span class="token function">initMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 创建第一个模型</span>
		group1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		group1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'group1'</span>
		<span class="token keyword">var</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SphereGeometry</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xffff00</span><span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span> geometry<span class="token punctuation">,</span> material <span class="token punctuation">)</span><span class="token punctuation">;</span>
		group1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
		group1<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 创建第一个Cube的Cannon.js刚体</span>
		<span class="token comment">// 创建Cannon.js中的球体几何体</span>
		<span class="token keyword">let</span> radius <span class="token operator">=</span> <span class="token number">2</span>
		cubeShape1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Sphere</span><span class="token punctuation">(</span>radius<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 定义物理体的属性，如质量、位置等</span>
		cubeBody1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Body</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		    <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 物体的质量，可以根据需要调整</span>
		    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Vec3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 物理体的初始位置，这里假设与Three.js中的球体位置相同</span>
		    <span class="token literal-property property">shape</span><span class="token operator">:</span> cubeShape1<span class="token punctuation">,</span> <span class="token comment">// 使用上面创建的球体形状</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cubeBody1<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>group1<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
		world<span class="token punctuation">.</span><span class="token function">addBody</span><span class="token punctuation">(</span>cubeBody1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 创建第二个模型</span>
		group2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		group2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'group2'</span><span class="token punctuation">;</span>
		material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span>xyz<span class="token punctuation">.</span>x<span class="token punctuation">,</span> xyz<span class="token punctuation">.</span>y<span class="token punctuation">,</span> xyz<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
		group2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
		group2<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 创建第二个Cube的Cannon.js刚体</span>
		cubeShape2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Box</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Vec3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cubeBody2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Body</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">shape</span><span class="token operator">:</span> cubeShape2 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cubeBody2<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		world<span class="token punctuation">.</span><span class="token function">addBody</span><span class="token punctuation">(</span>cubeBody2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// console.log(world, 'word')</span>
		
		<span class="token comment">// 监听碰撞事件</span>
		cubeBody2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'collide'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'cubeBody2'</span><span class="token punctuation">,</span> <span class="token string">'and'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">onWindowResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    camera<span class="token punctuation">.</span>aspect <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    world<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cubeBody2<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">-=</span> <span class="token number">0.02</span><span class="token punctuation">;</span>
    <span class="token comment">// 更新Three.js模型的位置</span>
    group1<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>cubeBody1<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    group1<span class="token punctuation">.</span>quaternion<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>cubeBody1<span class="token punctuation">.</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>
    group2<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>cubeBody2<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    group2<span class="token punctuation">.</span>quaternion<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>cubeBody2<span class="token punctuation">.</span>quaternion<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br></div></div><p><strong>自动碰撞检测场景演示</strong> <img src="/blog/assets/img/cannon自动碰撞.67f27464.gif" style="height:100%;width:100%;"></p></details> <h3 id="拖拽碰撞检测场景"><a href="#拖拽碰撞检测场景" class="header-anchor">#</a> 拖拽碰撞检测场景</h3> <details><summary><b>代码及效果展示</b></summary> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>utf-8</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>001-拖放控制器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>../common.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 这里是本地js，使用时需要更改地址 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/three.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/DragControls.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/GLTFLoader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./js/OrbitControls.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">/**
   * 3D场景中进行平移，在不旋转的情况下，只看到物体跟随鼠标以平行于窗口的轨迹运动
   */</span>
  <span class="token keyword">let</span> renderer<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> scene<span class="token punctuation">,</span>
    light<span class="token punctuation">,</span> mesh<span class="token punctuation">,</span>
    cameraControls<span class="token punctuation">,</span>
	group1<span class="token punctuation">,</span> group2<span class="token punctuation">,</span> model<span class="token punctuation">,</span>
	cubeShape1<span class="token punctuation">,</span> cubeBody1<span class="token punctuation">,</span> cubeShape2<span class="token punctuation">,</span> cubeBody2<span class="token punctuation">;</span>
<span class="token keyword">let</span> xyz <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	<span class="token literal-property property">z</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建物理引擎世界</span>
<span class="token keyword">let</span> world <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>World</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// world.gravity.set(0, -9.82, 0);</span>

  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化渲染器</span>
    <span class="token function">initScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化场景</span>
    <span class="token function">initLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化光</span>
    <span class="token function">initCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化相机</span>
    <span class="token keyword">await</span> <span class="token function">initMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化模型</span>
    <span class="token function">initControls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//轨道相机控制器</span>
	<span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>onresize <span class="token operator">=</span> onWindowResize<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">//初始化渲染器</span>
  <span class="token keyword">function</span> <span class="token function">initRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
	renderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span><span class="token string">'#fff'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//初始化场景</span>
  <span class="token keyword">function</span> <span class="token function">initScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 创建3维坐标系</span>
	<span class="token keyword">let</span> AxesHelper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AxesHelper</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
	scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>AxesHelper<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//初始化相机</span>
  <span class="token keyword">function</span> <span class="token function">initCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//x,y,z</span>
    camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//初始化光</span>
  <span class="token keyword">function</span> <span class="token function">initLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AmbientLight</span><span class="token punctuation">(</span><span class="token number">0x444444</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    light <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLight</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    light<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//平行光开启阴影投射</span>
    light<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

   
	<span class="token keyword">function</span> <span class="token function">initMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 创建第一个模型</span>
		group1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		group1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'group1'</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 立方体</span>
		<span class="token comment">// material = new THREE.MeshLambertMaterial({color: 'red'});</span>
		<span class="token comment">// geometry = new THREE.BoxGeometry(xyz.x, xyz.y, xyz.z);</span>
		<span class="token comment">// mesh = new THREE.Mesh(geometry, material);</span>
		<span class="token comment">// group1.add(mesh);</span>
		<span class="token comment">// group1.position.set(0, 0, 0);</span>
		<span class="token comment">// scene.add(group1);</span>

		<span class="token comment">// 球</span>
		<span class="token keyword">var</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SphereGeometry</span><span class="token punctuation">(</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token number">0xffff00</span><span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">var</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span> geometry<span class="token punctuation">,</span> material <span class="token punctuation">)</span><span class="token punctuation">;</span>
		group1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
		group1<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group1<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 创建第一个Cube的Cannon.js刚体</span>
		<span class="token comment">// 立方体</span>
		<span class="token comment">// cubeShape1 = new CANNON.Box(new CANNON.Vec3(0.5, 0.5, 0.5));</span>
		<span class="token comment">// cubeBody1 = new CANNON.Body({ mass: 1, shape: cubeShape1 });</span>
		<span class="token comment">// cubeBody1.position.set(0, 0, 0);</span>
		<span class="token comment">// world.addBody(cubeBody1);</span>

		<span class="token comment">// 球</span>
		<span class="token comment">// 创建Cannon.js中的球体几何体</span>
		<span class="token keyword">let</span> radius <span class="token operator">=</span> <span class="token number">2</span>
		cubeShape1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Sphere</span><span class="token punctuation">(</span>radius<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 定义物理体的属性，如质量、位置等</span>
		cubeBody1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Body</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		    <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 物体的质量，可以根据需要调整</span>
		    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Vec3</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 物理体的初始位置，这里假设与Three.js中的球体位置相同</span>
		    <span class="token literal-property property">shape</span><span class="token operator">:</span> cubeShape1<span class="token punctuation">,</span> <span class="token comment">// 使用上面创建的球体形状</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cubeBody1<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>group1<span class="token punctuation">.</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
		world<span class="token punctuation">.</span><span class="token function">addBody</span><span class="token punctuation">(</span>cubeBody1<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 创建第二个模型</span>
		group2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		group2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'group2'</span><span class="token punctuation">;</span>
		material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshLambertMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span>xyz<span class="token punctuation">.</span>x<span class="token punctuation">,</span> xyz<span class="token punctuation">.</span>y<span class="token punctuation">,</span> xyz<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> material<span class="token punctuation">)</span><span class="token punctuation">;</span>
		group2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span><span class="token punctuation">;</span>
		group2<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>group2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 创建第二个Cube的Cannon.js刚体</span>
		cubeShape2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Box</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Vec3</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cubeBody2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CANNON<span class="token punctuation">.</span>Body</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mass</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">shape</span><span class="token operator">:</span> cubeShape2 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cubeBody2<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		world<span class="token punctuation">.</span><span class="token function">addBody</span><span class="token punctuation">(</span>cubeBody2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 监听碰撞事件</span>
		cubeBody2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'collide'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			group2<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0x000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'cubeBody2'</span><span class="token punctuation">,</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">initControls</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> <span class="token string">'----'</span><span class="token punctuation">)</span>
	<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>scene<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scene<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> dragControls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DragControls</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> camera<span class="token punctuation">,</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    dragControls<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragstart'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">'event前'</span><span class="token punctuation">)</span>
      cameraControls<span class="token punctuation">.</span>enabled <span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
	  <span class="token comment">// 当开始拖拽时，禁用物理模拟</span>
	  <span class="token comment">// cubeBody1.sleep();</span>
	  <span class="token comment">// cubeBody2.sleep();</span>
      <span class="token comment">// event.object.material.emissive.set(0xaaaaaa);</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	dragControls<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'drag'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// event.object.name</span>
	  
	  <span class="token comment">// console.log(event, '999')</span>
	  cubeBody2<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>group2<span class="token punctuation">.</span>position<span class="token punctuation">)</span>
	  cubeBody2<span class="token punctuation">.</span>quaternion<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>group2<span class="token punctuation">.</span>quaternion<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    dragControls<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragend'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token string">'event后'</span><span class="token punctuation">)</span>
      <span class="token comment">// event.object.material.emissive.set(0x000000);</span>
      cameraControls<span class="token punctuation">.</span>enabled <span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
	  <span class="token comment">// 当拖拽结束时，重新启用物理模拟</span>
	  <span class="token comment">// cubeBody1.wakeUp();</span>
	  <span class="token comment">// cubeBody2.wakeUp();</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cameraControls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OrbitControls</span><span class="token punctuation">(</span>camera<span class="token punctuation">,</span> renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// cannonDebugger.update()</span>
    renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">onWindowResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    camera<span class="token punctuation">.</span>aspect <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">;</span>
    camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 更新帧数</span>
    <span class="token comment">// stats.update()</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    world<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br></div></div><p><strong>拖拽碰撞检测场景演示</strong> <img src="/blog/assets/img/cannon拖动碰撞.f14e2d28.gif" style="height:100%;width:100%;"></p></details></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/article/Three/IntelligentPackingFunction.html" class="prev">
        Three常见问题及解决方案
      </a></span> <span class="next"><a href="/blog/article/Python/Grammar.html">
        Grammar
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.95d1cef2.js" defer></script><script src="/blog/assets/js/2.dd56d6fa.js" defer></script><script src="/blog/assets/js/1.05d0606b.js" defer></script><script src="/blog/assets/js/31.a2ef508f.js" defer></script>
  </body>
</html>
